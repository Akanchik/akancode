<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>AKANCODE Язык</title>
<style>
  body { font-family: monospace; background: #1e1e1e; color: #cfcfcf; margin: 20px; }
  textarea { width: 100%; height: 180px; background: #2d2d2d; color: #eee; border: none; padding: 10px; font-size: 16px; }
  #output { white-space: pre-wrap; margin-top: 15px; background: #111; padding: 10px; min-height: 150px; border-radius: 5px; }
  button { margin-top: 10px; padding: 10px 20px; font-size: 16px; background: #007acc; border: none; color: white; border-radius: 4px; cursor: pointer; }
  button:hover { background: #005a9e; }
  #game-container { margin-top: 15px; background: #222; padding: 10px; border-radius: 5px; }
  #game-input { width: 60px; font-size: 16px; padding: 5px; }
</style>
</head>
<body>

<h2>AKANCODE Онлайн V0.1.0 БЕТА</h2>

<textarea id="code" spellcheck="false" placeholder="Напишите здесь ваш AKANCODE код..."></textarea>
<br>
<button onclick="runCode()">Запустить</button>

<div id="output"></div>
<div id="game-container"></div>

<script>
const outputDiv = document.getElementById("output");
const gameContainer = document.getElementById("game-container");

function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

async function печать_по_буквам(текст, задержка = 100) {
  for (let i = 0; i < текст.length; i++) {
    outputDiv.innerHTML += текст[i];
    await sleep(задержка);
  }
  outputDiv.innerHTML += "<br>";
}

async function runCode() {
  outputDiv.innerHTML = "";
  gameContainer.innerHTML = "";
  const code = document.getElementById("code").value.split("\n");
  let variables = {};
  let i = 0;

  function startGuessGame() {
    gameContainer.innerHTML = `
      <div>Угадай число от 1 до 10!</div>
      <input type="number" id="game-input" min="1" max="10" />
      <button id="game-submit">Угадать</button>
      <div id="game-message" style="margin-top:10px;"></div>
    `;

    const input = document.getElementById("game-input");
    const button = document.getElementById("game-submit");
    const message = document.getElementById("game-message");
    const number = Math.floor(Math.random() * 10) + 1;
    let attempts = 3;

    button.onclick = () => {
      let guess = parseInt(input.value);
      if (isNaN(guess) || guess < 1 || guess > 10) {
        message.innerText = "Пожалуйста, введите число от 1 до 10.";
        return;
      }
      attempts--;
      if (guess === number) {
        message.innerText = "Правильно! Ты угадал!";
        button.disabled = true;
        input.disabled = true;
      } else if (attempts > 0) {
        message.innerText = guess < number ? "Больше!" : "Меньше!";
      } else {
        message.innerText = `Ты проиграл! Число было ${number}.`;
        button.disabled = true;
        input.disabled = true;
      }
      input.value = "";
      input.focus();
    };
    input.focus();
  }

  while (i < code.length) {
    let line = code[i].trim();
    if (!line || line.startsWith("#")) {
      i++;
      continue;
    }

    const parts = line.split(" ");
    const cmd = parts[0].toUpperCase();

    try {
      if (cmd === "ВВОД") {
        let varName = parts[1];
        let val = prompt(`Введите значение для ${varName}:`);
        val = isNaN(parseInt(val)) ? val : parseInt(val);
        variables[varName] = val;
      } else if (cmd === "ПРИСВОИТЬ") {
        let varName = parts[1];
        if (parts[2] === "=") {
          let val = parts[3];
          val = isNaN(parseInt(val)) ? (variables[val] ?? val) : parseInt(val);
          variables[varName] = val;
        }
      } else if (cmd === "СЛОЖИТЬ") {
        let resultVar = parts.pop();
        let total = 0;
        for (let v of parts.slice(1)) {
          total += parseInt(variables[v] ?? 0);
        }
        variables[resultVar] = total;
      } else if (cmd === "ВЫЧЕСТЬ") {
        let a = parts[1];
        let b = parts[2];
        let resultVar = parts[3];
        let aVal = parseInt(variables[a] ?? 0);
        let bVal = parseInt(variables[b] ?? 0);
        variables[resultVar] = aVal - bVal;
      } else if (cmd === "УМНОЖИТЬ") {
        let a = parts[1];
        let b = parts[2];
        let resultVar = parts[3];
        let aVal = parseInt(variables[a] ?? 0);
        let bVal = parseInt(variables[b] ?? 0);
        variables[resultVar] = aVal * bVal;
      } else if (cmd === "ДЕЛИТЬ") {
        let a = parts[1];
        let b = parts[2];
        let resultVar = parts[3];
        let aVal = parseInt(variables[a] ?? 0);
        let bVal = parseInt(variables[b] ?? 1);
        if (bVal === 0) {
          variables[resultVar] = "Ошибка: деление на 0";
        } else {
          variables[resultVar] = aVal / bVal;
        }
      } else if (cmd === "СЛУЧАЙНО") {
        let a = parseInt(variables[parts[1]] ?? parts[1]);
        let b = parseInt(variables[parts[2]] ?? parts[2]);
        let resultVar = parts[3];
        variables[resultVar] = Math.floor(Math.random() * (b - a + 1)) + a;
      } else if (cmd === "ВЫВЕСТИ") {
        let expr = parts.slice(1).join(" ");
        let outputText = "";
        if (expr.includes("+")) {
          for (let part of expr.split("+")) {
            part = part.trim().replace(/^"|"$/g, "");
            outputText += variables[part] ?? part;
          }
        } else {
          expr = expr.trim().replace(/^"|"$/g, "");
          outputText = variables[expr] ?? expr;
        }
        outputDiv.innerHTML += outputText + "<br>";
      } else if (cmd === "ПЕЧАТАТЬ") {
        let text = parts.slice(1).join(" ");
        if (text.startsWith('"') && text.endsWith('"')) {
          await печать_по_буквам(text.slice(1, -1));
        } else {
          let val = variables[text] ?? `[ОШИБКА: переменная '${text}' не найдена]`;
          await печать_по_буквам(String(val));
        }
      } else if (cmd === "ИГРА" && parts[1].toUpperCase() === "УГАДАЙ") {
        startGuessGame();
      }
      // Здесь можно добавить еще команды по желанию
    } catch (e) {
      outputDiv.innerHTML += "Ошибка: " + e.message + "<br>";
    }

    i++;
  }
}
</script>

</body>
</html>